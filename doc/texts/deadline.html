<i>Продолжаю знакомить читателей Хабра с главами из своей книжки «Теория счастья» с подзаголовком «Математические основы законов подлости». Это ещё не изданная научно-популярная книжка, очень неформально рассказывающая о том, как математика позволяет с новой степенью осознанности взглянуть на мир и жизнь людей. Она для тех кому интересна наука и для тех, кому интересна жизнь. А поскольку жизнь наша сложна и, по большому счёту, непредсказуема, упор в книжке делается, в основном, на теорию вероятностей и математическую статистику. Здесь не доказываются теоремы и не даются основы науки, это ни в коем случае не учебник, а то, что называется recreational science. Но именно такой почти игровой подход позволяет развить интуицию, скрасить яркими примерами лекции для студентов и, наконец, объяснить нематематикам и нашим детям, что же такого интересного мы нашли в своей сухой науке.</i>

Опубликованные главы:

&emsp;•&ensp; <a href="https://habr.com/post/416941/">Введение в мерфологию</a>
&emsp;•&ensp; <a href="https://habr.com/post/416551/">Закон арбузной корки и нормальность ненормальности</a>
&emsp;•&ensp; <a href="https://habr.com/post/416907/">Закон зебры и чужой очереди</a>

<img src="http://ungkom.dk/wp-content/uploads/2018/02/Den-kreative-proces.001.jpeg"/>

Мы порассуждаем о цейтнотах, дедлайнах и о невовремя ломающихся принтерах.

<cut/>

<h3>Стратегия балбеса</h3>

В предыдущей главе мы говорили о случайных процессах. Одним из самых простых процессов, требующих минимума дополнительных предположений, является пуассоновский поток. Напомню, что его можно реализовать, случайно распределяя известное количество независимых событий по временному интервалу. Хорошими примерами могут быть удары капель дождя по крыше, поток частных автомобилей на дороге, сильные землетрясения и т.п.

А что мы получим, если события перестанут быть независимыми, а будут образовывать упорядоченную цепочку? Cкажем, в цепочке $inline$\{A,B,C\}$inline$ событие $inline$B$inline$ может случиться только после события $inline$A$inline$ и перед событием $inline$C$inline$, хотя моменты в которые эти события произойдут пусть остаются случайными. Посмотрим, как разместятся такие упорядоченные цепочки на ограниченном временном интервале. Первое событие мы расположим в произвольной точке, второе тоже случайно, но обязательно позднее первого, третье -- после второго и так далее. Для каждого следующего этапа будет оставаться всё меньше и меньше времени, так что к правой части интервала (перед дедлайном) должно наблюдаться заметное увеличение интенсивности процесса. Рано или поздно, время для выполнения задач закончится и цепочка завершится. Назовём построенный нами процесс <i>стохастической цепочкой с дедлайном</i>, а выбранную безалаберную стратегию выполнения работы <i>стратегией балбеса</i>. На рисунке показан пример построенной таким образом цепочки из $inline$5$inline$ этапов работы, на которую было отпущено $inline$10$inline$ дней.

<img src="https://habrastorage.org/webt/y_/am/es/y_amespaf2yxggpbclhnfxyoyzk.png" width='75%' align='center'/>
<i><font color="#444">Пример стохастической цепочки с дедлайном. В данном случае пять дел сделать удалось, можно ещё успеть сделать шестое, а на семь времени уже не хватит.</font></i>

Сформулируем задачу, взяв в качестве испытуемого, скажем, театрального режиссёра. Пусть в распоряжении режиссёра и труппы имеется $inline$n$inline$ дней для постановки некоего действа. Подготовка разбивается на $inline$k$inline$ последовательных репетиционных этапов, каждый из которых требует один день на выполнение. Какова вероятность не уложиться в срок, реализуя описанный нами процесс выполнения работ? Если подготовка мероприятия требует вовлечения разных людей и различных производственных процессов, то возможны накладки, болезни или попросту хандра -- все предпосылки к реализации нашей стохастической цепочки с дедлайном.

Для начала, я обратился к имитационному моделированию, чтобы выяснить, как распределяется длина цепочек, которые удаётся выполнить в ограниченный промежуток времени заданной длины, пользуясь стратегией балбеса. Вот что получается для $inline$n=10$inline$:

<img src="https://habrastorage.org/webt/uh/78/xu/uh78xuzslz5ij-qiynegvd889qe.png" width='75%' align='center'/>
<i><font color="#444">Функция вероятности для длины цепочек, которые  удаётся сделать в отведённый срок.</i></font>

Это распределение не встретилось ни в каких справочниках по теории вероятностей и математической статистике. Мне удалось получить аналитическое решение для функции вероятности в конечной форме: 
$$display$$P_n(k)=\genfrac{[}{]}{0pt}{}{n}{k}\frac{1}{n!},$$display$$ здесь $inline$P_n(k)$inline$ -- вероятность выполнения цепочки длиной $inline$k$inline$ в $inline$n$inline$ отрезков времени, а конструкция $inline$\genfrac{[}{]}{0pt}{}{n}{k}$inline$ обозначает так называемые <i>числа Стирлинга первого рода</i>, они возникают в комбинаторике при подсчёте циклических перестановок. По праву первооткрывателя, назову это распределение именем Стирлинга. Удалось даже получить точные выражения для математического ожидания длины цепочек и их дисперсии: $$display$$M[k] = H_{n},\quad D[k] = H_{n}-H_n^{(2)}.$$display$$ Здесь $inline$H_{n}$inline$ -- это гармоническое число: частичная сумма расходящегося гармонического ряда $inline$\{1,\frac12,\frac13,...,\frac1n\}$inline$, а $inline$H_{n}^{(2)}$inline$ -- частичная сумма ряда $inline$\{1,\frac14,\frac19,...,\frac1{n^2}\}$inline$. Собственно, ради вычисления этих значений я и исследовал получившееся распределение. Средняя длина цепочек с ростом $inline$n$inline$ растёт очень медленно, хоть и неограниченно. Не сильно ошибившись, можно сказать, что она растёт логарифмически. В свою очередь, дисперсия не сильно отличается от среднего, а добавочный коэффициент $inline$H_{n}^{(2)}$inline$ стремится к константе $inline$\pi^2/6$inline$. Немного позже нам пригодится это наблюдение.

Взглянем ещё раз на распределение длины цепочек. Видно, что шансов не успеть сделать одно дело нет совсем -- для него время найдётся обязательно. Короткие цепочки из двух дел составляют десятую часть общего числа -- это такие неудачные цепочки, которые начались в последний день (из десяти) и не оставили времени на продолжение. Доля очень длинных цепочек, ожидаемо, невелика и уменьшается с увеличением их длины, практически исчезая. Ну, а цепочку из десяти дел случайно выполнить практически нереально --
 вероятность такого исхода равна $inline$\frac{1}{10!}$inline$.

На наш вопрос: какова вероятность, не уложиться в $inline$n$inline$ дней, имея перед собой $inline$k$inline$ последовательных этапов выполнения задачи, поможет ответить функция распределения --  кумулятивная кривая для распределения Стирлинга. Построим такие кривые для $inline$n = 7,\ 30,\ 365$inline$ и $inline$25000$inline$, соответствующие неделе, месяцу, году и (конечно, условно) всей жизни.

<img src="https://habrastorage.org/webt/iz/0j/_i/iz0j_ij1urg7yz-jnbd7voord50.png"  width="75%" align='center' />
<i>Вероятность не успеть выполнить цепочки различной длины в тот или иной срок.</i>

Эти графики показывают, что вероятность не уложиться в месяц с заданием, имеющим $inline$5$inline$ шагов, превышает $inline$80\%$inline$. И что неорганизованному балбесу в неделю лучше не планировать более трёх дел, а десяток дел он не сделает, с вероятностью, превышающей $inline$50\%$inline$, и за всю жизнь! Мы убеждаемся в том, что при увеличении сроков на несколько порядков, число выполнимых как попало дел увеличивается незначительно. Жизнь так коротка!

<h3>Быстрее, ещё быстрее!</h3>

Давайте теперь исследуем само явление цейтнота, его выматывающие свойства.  Для этого построим несколько тысяч стохастических цепочек и усредним их, чтобы получить ожидаемый <i>темп выполнения работы</i>.

<img src="https://habrastorage.org/webt/kj/bc/a5/kjbca5fjzxzhs7tuuw-xdfwjmwq.png" width='75%' align='center'/>
<i><font color="#444">Множество стохастических цепочек с дедлайном и ожидаемый темп выполнения работы.</font></i>

Обратите внимание на то, что оси графика приведены к общему числу дел и всему отпущенному времени. Это, с одной стороны, позволяет нам сравнивать, как разные сроки, так и различные по длине цепочки, а с другой -- мы опять получили что-то подобное кривой Лоренца: некое формализованное отражение несправедливости. 

Наблюдаемый темп, увы, сильно неравномерен: в первую половину срока будет сделано едва ли $inline$10\%$inline$ работы, а добрую половину всех дел придётся выполнять, имея в своём распоряжении мене $inline$10\%$inline$ времени, но главная особенность: темп, вернее его наклон, стремительно увеличивается при приближении к дедлайну! Мы получили модель предновогоднего ража или паники в преддверии годового отчёта, а также нащупали закон подлости, знакомый всякому, кому приходилось организовывать концерт, костюмированный вечер или иное мероприятие:

<blockquote>
Сколько бы времени ни было отпущено на подготовку мероприятия, большая часть дел останется на последнюю ночь!
</blockquote>

Прекрасные живые примеры таких процессов описаны, например, в рассказах Карела Чапека <a href="http://thelib.ru/books/chapek_karel/kak_delaetsya_gazeta-read.html">"Как делают газету"</a> и <a href="http://thelib.ru/books/chapek_karel/kak_stavitsya_pesa-read.html">"Как ставится пьеса"</a>. Неужели причина этого проклятия только в нашей неорганизованности и безалаберности? Это, конечно основные причины, но мы не настолько в ней виноваты, чтобы нельзя было попробовать оправдаться каким-либо математическим законом. Стратегия балбеса, конечно выглядит глупо, но экспоненциальный рост темпа -- это не шутки! Можно ли вообще с ним справиться?

Ожидаемый темп выполнения работы можно вычислить точно. Формула не слишком изящна, однако примечательно, что в неё входит число дней $inline$n$inline$ и не входит число запланированных дел: $$display$$T_n(x)=-\frac{\log_2\left[1-x \left(1-2^{-H_n-1}\right)\right]}{H_n+1}.$$display$$ Логарифм -- функция медленная, если только его не прижать к стенке. В последние дни перед дедлайном темп растёт катастрофически, с такой же скоростью, с которой логарифм проваливается в бездну при приближении к нулю. Однако, от числа выделенных дней он, всё же зависит. Можно посмотреть на то как выглядит ожидаемый темп для недели, месяца, и года:

<img src="https://habrastorage.org/webt/wq/kq/nd/wqkqnda31dhxwfdkmvbiyemox-q.png"  width='75%' align='center'/>
<i><font color="#444">Наиболее вероятный темп выполнения работы в ограниченный срок. Интересно, что жёсткое ограничение по времени влияет благотворно. Имя в запасе всего неделю, мы, скорее всего, станем выполнять работу равномернее (к половине срока будет готова треть работы), а если впереди целый год, то можно и расслабиться, ну, а потом об этом пожалеть.</font></i>

У идеального исполнителя-перфекциониста, который выполняет работу абсолютно равномерно, темп выполнения должен стремиться к диагонали (синяя пунктирная линия на рисунке). Это похоже на кривую равенства на диаграмме Лоренца, знаменующую справедливость. Подобно тому как мы вычисляли коэффициент Джини для диаграммы Лоренца, мы можем, основываясь на площади между кривой темпа выполнения работ и идеальной кривой, вычислить некий коэффициент подлости, который покажет насколько мы далеки от идеала. Он зависит от длины выделенного срока и потихоньку увеличивается с ростом $inline$n$inline$. В приведённых нами примерах для недели, месяца и года, коэффициент подлости равен, соответственно $inline$0.25$inline$, $inline$0.44$inline$ и $inline$0.65$inline$.

Как же бороться с нарастающей волной забот и цейтнотом? Можно, например, взять себя в руки. Человек с синдромом отличника может стремиться сделать следующее дело как можно раньше, насколько это возможно, конечно. Правдоподобной моделью будет выбор момента для выполнения следующего дела, следуя экспоненциальному распределению с плотностью обратно пропорциональной оставшемуся времени. Это не исключит некоторой неопределённости, присущей нашей жизни, но выразит благие стремления делать все дела как можно скорее. Назовём эту стратегию <i>стратегией благих намерений</i>. Вот какими будут распределения вероятностей выполнения заданий в срок для приверженца этой стратегии, который в половине случаев сделает очередное дело в первую четверть оставшегося времени:

<img src="https://habrastorage.org/webt/93/0t/kh/930tkhdi5cf1duq1fz8pwz7f1om.png" width='75%' align='center'/>
<i><font color="#444">Распределение вероятности не успеть в срок для стратегии благих намерений.</font></i>

Существенно лучше! В течение недели можно с неплохой вероятностью успеть сделать пять дел и оставить себе два выходных дня. Но всё-же, для больших периодов увеличение возможностей не революционное. Проблема кроется в том, что ожидаемое число успешно завершаемых дел всё равно остаётся пропорциональным логарифму отпущенного времени, а логарифм растёт чрезвычайно медленно! Так что, планируя многое, нужно иметь в виду, что интенсивность процесса будет неизбежно возрастать, и времени в преддверии дедлайна, скорее всего, будет не хватать. В любом случае, необходимо помнить, что жизнь коротка и чтобы успеть реализовать задуманное, нужно действовать прямо сейчас!

Давайте полюбуемся на темп благонамеренного отличника.

<img src="https://habrastorage.org/webt/jz/91/wp/jz91wpbzzhanhxy0i8xps7y8nak.png" width='75%' align='center' />
<i><font color="#444">Ожидаемый темп выполнения работы методичным человеком, старающимся приступить к следующему этапу работы как можно скорее. На графиках представлены результаты усреднения десятка тысяч численных экспериментов, моделирующих выполнение задания с фиксированным числом этапов. Красной линией обозначен предельный темп для большого числа задач.</font></i>

Нашему аккуратисту удалось более равномерно распределить работу, и сделать существенно больше дел, но его всё равно ожидает цейтнот. Короткие цепочки такой человек будет выполнять с существенным перевыполнением плана, а цепочку из семи дел -- практически идеально. Однако по мере увеличения числа дел, ожидаемый темп быстро стремится к теоретическому темпу, полученному с помощью стратегии балбеса! Увеличилась общая производительность, но запарка перед самым дедлайном никуда не делись. Так что нагружая можно доканать и заправского зануду!

Впрочем, существует ещё один широко известный способ существенно дисциплинировать выполнение работ: вместо одного дедлайна надо сделать их много. Давайте разобьем срок выполнения работы на две равные части и будем придерживаться этого нового дедлайна, считая его, скажем, промежуточным отчётом. Для каждой из этих частей мы можем построить кривую ожидаемого темпа выполнения работ, как показано на рисунке.

<img src="https://habrastorage.org/webt/am/mi/yd/ammiyddry9wxpm5fmh0edssjsye.png" width='75%' align='center' /><i><font color="#444">Разбиение времени выполнения работы на несколько промежуточных отчётных периодов позволяет выполнить работу более равномерно, но добавляет стресс при приближении каждого нового отчёта.</font></i>

Несмотря на нервотрёпку с промежуточным отчётом, мы достигли свое цели: площадь под общей кривой темпа выполнения сократилась и коэффициент подлости уменьшился от $inline$0.65$inline$ до $inline$0.3$inline$. Кроме того, сокращение срока (вместе с сокращением числа дел, разумеется) приближает ожидаемый темп выполнения работы к идеальному, поэтому коэффициент подлости уменьшился более чем в два раза. Добавление ещё двух, скажем, квартальных отчётов, уменьшат его уже до $inline$0.13$inline$, но тем самым мы вгоним наших исполнителей сразу в четыре стрессовых периода и они всё равно станут громко страдать, жалуясь на судьбу и на начальство! Что же, мы можем показать работникам наши выкладки и доказать, что введя ежеквартальную отчётность, в пять раз понизили коэффициент подлости их жизни, если это, конечно, послужит им утешением.

Более того, при стремлении количества промежуточных дедлайнов к числу дней, отпущенных на работу, темп выполнения работы приблизится к идеальному, но очень занудному темпу.

<h3>Ну вот! Ещё и принтер сломался!</h3>

Добавим ещё пару слов о стратегии балбеса и распределении Стирлинга. Полученное нами распределение показывает вероятность получить заданное число событий в некотором временном интервале. Подсчитывая события в настоящем пуассоновском потоке с интенсивностью $inline$\lambda$inline$ мы придём к известному распределению Пуассона: $$display$$P(k) = e^{-\lambda}\frac{\lambda^k}{k!},$$display$$ описывающее верятность получить ровно $inline$k$inline$ событий в единичном интервале времени. Выражение для чисел Стирлинга имеет асимптотическое разложение, которое для больших $inline$n$inline$ сводит распределение длин цепочек с дедлайном к смещёноому распределению Пуассона с интенсивностью $inline$\lambda = H_n-1$inline$. Таким образом, наш стохастический процесс с дедлайном, с точки зрения статистики, можно рассматривать либо как пуассоновский процесс на сгущающейся временной сетке, либо как неоднородный пуассоновский процесс, интенсивность которого монотонно и стремительно растёт. И хотя, строго говоря, наш процесс не является пуассоновским, поскольку события в нём не независимы, однако, нужные нам статистические свойства у них схожи. Об их схожести говорит и подмеченная мной близость среднего значения и дисперсии распределения Стирлинга, характерная для пуассоновского распределения. 

Этот вывод позволяет задать вопрос: что если добавить к построенному нами процессу выполнения цепочки дел какие-либо независящие от нас редкие неприятности: пургу, жуткую пробку, насморк, поломку принтера, или всенародный праздник? 

Для пуассоновского процесса определён <i>процесс случайного прореживания</i>, заключающийся в том, что мы с какой-то вероятностью станем удалять события из потока. Случайное прореживание с вероятностью $inline$(1-p)$inline$ оставляет процесс пуассоновским, но его интенсивность уменьшается, умножаясь на $inline$p$inline$. События, соответствующие совпадению неприятности и какого-либо этапа выполнения работы сами образуют пуассоновский процесс, с существенно меньшей интенсивностью, но в нашем случае, также, монотонно и стремительно растущей. Так стремительно, что какой бы малой ни была вероятность неприятности, для достаточно большого числа дел (или срока, отведённого на работу), ближе к дедлайну она увеличится до вполне наблюдаемой. И принтер забарахлит именно накануне сдачи курсовика!

Не удивляйтесь если автобус сломается именно тогда, когда вы уже опаздываете. Автобус не желает вам зла. Просто, если вы девушка, то последовательность дел: выбрать платье, съесть конфетку, умыться, надеть выбранное платье, накраситься, надеть цепочку, переложить вещи из сумочки в клатч, почистить туфли и прочее и прочее подходит к самому главному и волнительному дедлайну -- к свиданию! И темп с которым вы летите навстречу судьбе уже такой сумасшедший, что начинают происходить самые маловероятные чудеса.

В конце концов, а что же такое чудо, как не реализация невероятного!
