<i>Продолжаю знакомить читателей Хабра с главами из своей книжки «Теория счастья» с подзаголовком «Математические основы законов подлости». Это ещё не изданная научно-популярная книжка, очень неформально рассказывающая о том, как математика позволяет с новой степенью осознанности взглянуть на мир и жизнь людей. Она для тех кому интересна наука и для тех, кому интересна жизнь. А поскольку жизнь наша сложна и, по большому счёту, непредсказуема, упор в книжке делается, в основном, на теорию вероятностей и математическую статистику. Здесь не доказываются теоремы и не даются основы науки, это ни в коем случае не учебник, а то, что называется recreational science. Но именно такой почти игровой подход позволяет развить интуицию, скрасить яркими примерами лекции для студентов и, наконец, объяснить нематематикам и нашим детям, что же такого интересного мы нашли в своей сухой науке.</i>

Опубликованные главы:

&emsp;•&ensp; <a href="https://habr.com/post/416941/">Введение в мерфологию</a>
&emsp;•&ensp; <a href="https://habr.com/post/416551/">Закон арбузной корки и нормальность ненормальности</a>
&emsp;•&ensp; <a href="https://habr.com/post/416907/">Закон зебры и чужой очереди</a>
&emsp;•&ensp; <a href="https://habr.com/post/421351/"> Проклятие режиссёра и проклятые принтеры</a>
&emsp;•&ensp; <a href="https://habr.com/post/424071/"> Термодинамика классового неравенства</a>

В этой главе мы порассуждаем о полёте бутерброда с маслом, о случайности выпадения орла или решки и, вообще, о природе случайности. А по пути заглянем в такие разделы математики, как теория мер, теория динамического хаоса и анализ размерностей.

<cut />

Разговор о законах подлости, как источнике житейских неурядиц, часто начинается со знаменитого <b>закона бутерброда</b>. Он просто формулируется, легко проверяется и широко известен:
<blockquote>Бутерброд всегда падает маслом вниз.</blockquote>
Понятно, что слово "всегда" здесь -- это преувеличение. Легко представить себе условия, в которых бутерброд упадет, оставив намазанную маслом сторону в сохранности. Что же люди понимают, под этим законом? Скорее всего, что бутерброд падает маслом вниз достаточно часто, чтобы это было заметно. Но чаще ли происходит неблагоприятный исход падения, чем благоприятный? Бутерброды разные, падают при различных обстоятельствах, с разной высоты... Параметров столько, что говорить о закономерностях в такой задаче, наверное, нет смысла. Всяко бывает. Бывает, что падает маслом вниз, тогда становится обидно, мы вспоминаем про закон и запоминаем его. А если бутерброд падает неинтересно -- маслом кверху, или если он оказался без масла вовсе, так и говорить не о чем -- понятно же, что закон-то шуточный! В конце концов, бутерброд подобен монетке, которую математики используют для получения случайных величин с двумя возможными значениями "орёл" и "решка". Если монетка "честная", то ей абсолютно неважно какой стороной падать, и мы говорим, что вероятность падения орла и решки одинаковы и равны $inline$1/2$inline$. По идее, с бутербродами дела должны обстоять также. 

Однако, тут есть тонкости. Монетку в теоретиковероятностных экспериментах подбрасывают каким-то особым магическим образом, так чтобы выбор начального положения, начальной скорости и скорости закручивания монетки при подбрасывании никак не влиял на вероятность конкретного исхода. Но очевидно же что это невозможно! Монетка представляет собой механическую систему и подчиняется законам механики, а они не содержат в себе случайных величин. Будущее в законах движения такого простого тела как монетка однозначно определяется прошлым состоянием этого тела. Если монетку будет подбрасывать робот, или демон Лапласа -- мифическое существо, обладающее полной информацией о координатах и скоростях любой механической системы, то при неизменных начальных данных, он будет получать идентичные результаты. Мы, конечно, не роботы и не демоны, но неужели люди подбрасывают монетки настолько неряшливо и непредсказуемо, что законы механики могут приводить к случайностям?

Это серьёзный вопрос: откуда берётся случайность в мире, описываемом законами механики? Откуда вообще, берётся случайность? В чём разница между истинно хаотическими или стохастическими системами, принципиально непредсказуемыми, и системами, в которых просто трудно угадать поведение, но его, в принципе, можно рассчитать?

<h3>Случайности не случайны?</h3>
Эта задача рассматривалась в 1986 году Джозефом Келлером. Мы приведём простое объяснение возникновению неопределённости в процессе подбрасывания монетки, основанное на рассуждениях из статьи Келлера. То какой стороной упадёт монетка, зависит только от времени её полёта $inline$t$inline$ и от угловой скорости $inline$\omega$inline$. Если измерять угловую скорость в оборотах за единицу времени, то число оборотов, совершаемое монеткой, выражается предельно просто $inline$n = t \omega$inline$. Эта зависимость задаёт линии равного числа оборотов в координатах $inline$(t,\omega)$inline$, а они, в свою очередь, ограничивают области, соответствующие чётному и нечётному числу оборотов.

<img src="https://habrastorage.org/webt/2u/am/t-/2uamt-kpskdnr1qg0nkmsyywjyw.png" width="70%" align="center"/><i>Диаграмма, показывающая чётность количества оборотов, совершаемых монеткой в полёте.</i>

На такой диаграмме можно показать каким будет результат подбрасывания монетки, закрученной на известное число оборотов в секунду, и пойманной через полсекунды после подбрасывания. Если попадаем в белую полоску, то выпадет та же сторона, что была сверху при подбрасывании, если в оранжевую -- обратная. Линии равного числа оборотов представляют собой гиперболы и видно, что по мере увеличения числа оборотов, чередование областей становится всё более и более частым, а сами области становятся тоньше. Человеческая рука несовершенна и очень небольшой разброс начальных значений перекрывает сразу много областей, делая исход непредсказуемым. В диапазоне действия руки (прямоугольник  на диаграмме) достаточно смещения на $inline$5\%$inline$ чтобы перескочить с белой полоски на оранжевую. Остаётся вопрос: а равны ли площади областей прямого и обратного положения монетки? От этого зависит насколько "честным" будет процесс подбрасывания.

Вообще говоря, площадь каждой полоски на нашей диаграмме бесконечна (если рассматривать всю четверть координатной плоскости). Однако, можно аккуратно показать, что это не мешает площадям заштрихованных и белых областей быть одинаковыми. Площадь -- является <i>мерой</i> плоской фигуры. Это точный математический термин, обозначающий некую величину, соответствующую измеримому множеству. Одно из главных свойств меры -- <i>аддитивность</i>, это значит, что при разбиении множества на непересекающиеся части, дополняющие друг друга до целого, сумма мер частей равна мере всего множества. Примерами мер являются количества в перечислимых множествах (количество яблок в мешке, количество рациональных чисел на отрезке), а также длины, площади, объёмы фигур. Понятие <i>вероятность</i> определяется, как мера на множестве, называемом <i>вероятностным пространством</i>, оно включает в себя как элементарные события, так и их комбинации (объединения и исключения).

В явном виде уравнения для наших кривых имеют вид $inline$\omega = n/t$inline$. Если  площадь под кривой $inline$\omega = 1/t$inline$ равна $inline$S$inline$, то благодаря свойству аддитивности, площадь под кривой $inline$\omega = n/t$inline$ будет равна $inline$S_n = n S$inline$. В свою очередь, для отдельных полосок получаем: $inline$ S_{n} - S_{n-1} = n S - (n-1)S = S$inline$. Выходит, разница площадей не зависит от "номера" гиперболы. Это не что-то особенное, относящееся к гиперболам, тот же вывод можно сделать для любой кривой вида $inline$y = n f(x)$inline$, лишь бы функция $inline$f$inline$ была измерима. Понятие меры позволяет взаимооднозначно связать площадь области и вероятность попадания точки в эту область. А раз так, то для всей области определения, попадания в белую часть диаграммы или в заштрихованную равновероятны, как и ожидается для "честной" монетки. 

Рассуждения, которые мы сейчас привели, кажутся достаточно простыми, но они дают весьма общий результат, применимый к любым аддитивным величинам. Абстрактное понятие меры позволило нам  сравнивать между собой бесконечные величины, оставаясь в рамках логики и здравого смысла, и с этим понятием мы ещё встретимся. В математике существует целый раздел, который называется <i>теорий мер</i>. Эта теория открыла математикам широкие возможности для анализа очень сложно устроенных объектов: канторовых и фрактальных множеств, она легла в основу функционального анализа и теории вероятностей. 

Абстракции это хорошо, но можно возразить, что в реальности мы подбрасываем монетки не со всеми возможными параметрами. Как показали эксперименты со скоростной камерой, угловые скорости попадают в диапазон от $inline$20$inline$ до $inline$40$inline$ оборотов в секунду, а длительность полёта -- от половины до одной секунды. Эта область выделена прямоугольником на диаграмме. В ней суммарная площадь белых полосок чуть больше чем оранжевых, и можно сделать вывод, что вероятность выпадения той же стороны, что была при подбрасывании, составит $inline$50.6\%$inline$.

В 2007 году серьёзный математический журнал Американского Общества промышленной и прикладной математики опубликовал статью Перси Диакониса с соавторами, в которой даётся развёрнутый анализ  процесса подбрасывания монетки. Детальное описание механики летящей и вращающейся монетки, которая, не просто вращается вокруг какой-то оси, а ещё и прецессирует -- ось вращения сама вращается в полёте, показывает, что при ручном подбрасывании из позиции орел сверху, вероятность выпадения орла на одну сотую больше половины. 

Много это или мало? Сколько нужно провести экспериментов, чтобы заметить такую разницу? По мере накопления экспериментальных данных, стандартная ошибка среднего, отражающая погрешность, с которой может быть вычислена средняя величина, уменьшается пропорционально квадратному корню из числа испытаний. $$display$$\sigma_{\mu} = \frac{\sigma}{\sqrt{n}},$$display$$ здесь $inline$\sigma$inline$ -- стандартное отклонение для исследуемого распределения. В нашем случае, для распределения Бернулли с вероятностью $inline$0.51$inline$, которое равно $inline$\sqrt{0.51\times0,49}\approx0.5$inline$. Чтобы уверенно выделить отклонение среднего в одну сотую, это отклонение должно превышать $inline$3$inline$ стандартных отклонения. Таким образом, мы можем оценить число испытаний: $$display$$n =
\left(\frac{\sigma}{\sigma_{\mu}}\right)^2 = \left(\frac{3\times0.5}{0.01}\right)^2 \approx 22500$$display$$ Столько раз нужно подбросить монетку, чтобы заметить механистическую предопределённость результата. Чтобы было понятнее, что имеется ввиду, приведу пример двухсот испытаний идеальной и слегка неидеальной "монеток", проводимых с целью вычислить вероятность выпадения, скажем, орла. Каждое испытание состоит в $inline$40000$inline$ "подбрасываниях". Слова "монетка" и "подбрасывание" взяты в кавычки, оттого, что на самом деле использовалась не физическая монетка, а генератор случайных чисел, подчиняющихся распределению Бернулли.

<img src="https://habrastorage.org/webt/pq/d2/hp/pqd2hpbqdysnxmwcw19gcili-kc.png" width="80%" align="center"/><i>Эксперименты с подбрасыванием идеальной и слегка неидеальной монетки с целью зафиксировать неидеальность.</i>

Видно, что только после $inline$20000$inline$ испытаний "облака" наблюдаемых значений среднего начинают отчётливо разделяться. Что же, для бытового использования можно считать, что монетка -- неплохой генератор случайного выбора из двух равновероятных вариантов. 

<img src="https://habrastorage.org/webt/9i/tt/42/9itt42myvc71zegikqmk7mro9jy.jpeg" width="40%" align="left"/>В сувенирных лавках можно найти магнитные маятники для "выбора желаний". Они тоже являются механическими генераторами случайности и их иногда ошибочно называют "хаотическими маятниками". Начав движение с каких-то начальных позиции и скорости, маятник совершает ряд "непредсказуемых" колебаний и, наконец, останавливается в одном из секторов. Однако колебания и здесь не являются непредсказуемыми, просто они очень чувствительны к начальным условиям. Для каждого сектора, в котором может остановиться маятник, существует <i>область притяжения</i> в пространстве координат-скорости. Это множество таких начальных условий при которых маятник обязательно притянется к определённой точке в указанном секторе. Точка в которой заканчивается движение маятника называется <i>аттрактором</i> -- притягивающей точкой. В случае маятника с картинки пространство координат и скоростей четырёхмерно, и так просто области притяжения не показать. Но если ограничиться лишь двумя секторами и свести задачу к одномерной, то пространство начальных значений превратится в плоскость, так что области притяжения можно будет увидеть. Они выглядят как замысловатый символ "Инь-Янь", быстро превращающийся в узкие полоски, разделяющие области притяжения. 

<img src="https://habrastorage.org/webt/yq/lc/dy/yqlcdyo5rpkf-ewr7nbo4cxengo.png" width="70%" align="center"/><i>Области притяжения аттракторов для одномерного маятника желаний.</i>

Как и в случае с монетой, немного смещая начальные условия мы попадаем от одного аттрактора к другому. Так же действует и игральная кость и рулетка, но они не являются сами по себе генераторами случайности. Это не истинно хаотические системы и их поведение можно точно рассчитать. 

А что же такое настоящая случайность? Хороший пример истинно стохастической системы -- появление автомобилей на дороге. Люди не договариваются, не согласовывают свои планы, каждый элемент ансамбля за пределами дороги действует независимо. И хотя в поведении людей есть определённые закономерности -- часы пик утром и вечером, пустые дороги ночью и т.д., мы не обладаем и никогда не будем обладать достаточной информацией о каждом участнике движения, чтобы предсказать появление любого из них. Также стохастическими являются механика элементарных частиц на квантовом уровне, распад нестабильных атомов, изменения в генетическом коде, по всей видимости, землетрясения и котировки ценных бумаг на бирже. Единственное, что остаётся исследователю, это рассматривать их, как случайные величины и описывать в терминах теории вероятности.

Но есть и другой источник случайностей -- <i>динамический хаос</i>. Хаотические системы отличаются от стохастических тем, что описываются точными уравнениями и параметрами, не содержащими случайностей. Однако их поведение не просто сложно, а хаотично и истинно непредсказуемо. Если мы начнём колебать маятник желаний, очень аккуратно, с точно контролируемой частотой и амплитудой, то мы обнаружим что его плавные движения невозможно просчитать надолго. Никакими алгоритмами на сколь угодно точных вычислительных машинах нам не удастся рассчитать точное поведение маятника на произвольно долгое будущее. Он не остановится на каком-либо секторе, а будет совершать плавные движения, но никогда не вернётся в одну и ту же точку в пространстве координат-скорости дважды. Ещё один пример предельно простой хаотической системы -- идеальный шарик, подпрыгивающий в поле тяжести на идеальном столике с пружинкой. Сравнительно простые уравнения Лоренца показали, что мы никогда не сможем предсказывать погоду больше чем на пару-тройку недель -- это тоже хаотическая система. 

Теории динамического хаоса, удалось объяснить природу такой непредсказуемости. Простой одномерный маятник желаний, который мы рассматривали, имел две устойчивые стационарные точки -- два аттрактора, и одну неустойчивую, от  которой система старается уйти, она показана белым кружком. В хаотическом режиме вместо набора аттракторов в системе появляется бесконечное множество неустойчивых стационарных траекторий. Это множество бесконечно, но имеет <i>нулевую меру</i>, и представляет собой очень сложно устроенную несвязную структуру. Попав на одну таких траекторий, в принципе невозможно ей следовать, используя какие-либо конечные алгоритмы. Но самое удивительное, оказалось, что это бесконечное множество неустойчивых траекторий само по себе является притягивающим! <img src="https://habrastorage.org/webt/z-/m3/do/z-m3do2rhl7w0uzt4idcnepnpxa.png" width="50%" align="right"/> Хаотическая система непрерывно перескакивает от окрестности одной неустойчивой траектории к другой, всё время оставаясь в пределах это странного аттрактора. Так эти множества и называются: <i>странные аттракторы</i>. Вот как завораживающе красиво выглядит сечение плоскостью странного аттрактора для маятника желаний, подверженного гармоническим колебаниям. Этот объект для одномерного маятника можно описать в трёхмерном пространстве (координата, скорость, фаза вынужденного колебания). Если рассечь аттрактор в этом пространстве плоскостью то можно увидеть его структуру, это называется <i>сечением Пуанкаре</i>. Каждая точка здесь -- это след траектории, а цвет точек отражает относительную скорость с которой траектории разбегаются друг от друга.

Гладкость хаотической траектории позволяет всё же немного заглядывать в будущее. Это объясняет одно досадное наблюдение: с одной стороны, синоптики, порой, не могут уверенно предсказать погоду на неделю, но с другой, если вы скажете, что завтра будет такая же погода, как и сегодня, то не ошибётесь примерно в трёх случаях из четырёх. Вообще же, анекдоты о синоптиках несправедливы и нужно отдать должное человеческой мысли и упорству, которые позволили предсказывать погоду на современном уровне! 

Динамический хаос очень сложен и красив как теория, он порождает изумительные по элегантности образы, но он может быть ещё и полезен. Например, алгоритмы, с помощью которых генерируются случайные числа в компьютерах тоже детерминированы. Для примеров в этой книге, я пользовался генератором псевдослучайных чисел, который не запускал реальный стохастический процесс (альфа-распад, или подсчёт машин на дороге), а вычислял следующее "случайное" число на базе предыдущих, полученных им ранее.

<h3>Кидаем бутерброды в Монте-Карло!</h3>
Но вернёмся к нашим бутербродам. Мы редко их подбрасываем как монетку, по крайней мере, когда становимся старше двух лет. Чаще всего, мы невольно повторяем примерно один и тот же эксперимент: бутерброд, изначально расположенный маслом вверх, выскальзывает из рук, или соскальзывает со стола. В процессе соскальзывания он закручивается, летит в воздухе, и, наконец, шлёпается на стол или на пол. При этом процессом управляет ряд параметров: трение о пальцы или поверхность, начальное положение бутерброда и его начальная скорость, высота падения, наконец, размеры бутерброда. Имеем динамическую систему с несколькими входными параметрами и одним выходным -- положением бутерброда на полу. Внутри системы, как и в случае с монеткой, работают механические законы, которые описываются дифференциальными уравнениями и они <i>детерминистические</i>. Это значит, что в них нет никаких случайностей -- результат зависит только от входных данных и при точном повторении параметров мы должны получать идентичные результаты. Это относится к модели бутерброда, представленной в виде системы дифференциальных уравнений, а что насчёт настоящих бутербродов, шероховатых и неповторимых, роняемых настоящими людьми в ресторанах, на улице, или на диване? Изменчивость реального мира можно описать, подавая на вход детерминистической системы случайные параметры, описываемые известными распределениями. На выходе мы тоже будем получать случайную величину и в качестве результата нас может интересовать её распределение, а также такие параметры, как математическое ожидание, дисперсия и пр. 

Однако, даже алгебра случайных величин, включающая в себя лишь сложение и умножение -- дело непростое, а у нас дифференциальные уравнения! Мы не полезем в эти увлекательные дебри, а используем хорошо отработанную во многих областях технику -- <i>метод Монте-Карло</i>. Он состоит в накоплении статистики и в определении свойств некой сложной системы в результате многократных испытаний с различными случайными параметрами. Подчеркну ещё раз: исследуемая система не стохастична и не хаотична, и на случайные входные данные она реагирует предсказуемо. В методе Монте-Карло случайность нужна лишь для того, чтобы эффективно перебрать как можно больше вариантов и заглянуть во все реалистичные "углы", получив представление о поведении системы.

По существу методом Монте-Карло мы уже пользовались, наблюдая за велосипедистами на горке и ещё будем пользоваться устраивая дедлайн в офисе, и деля деньги в замкнутом обществе. Взаимооднозначное соответствие между вероятностью и мерой объёма и площади, о котором мы говорили ранее, позволяет использовать метод Монте Карло для численного интегрирования. Особенность предстоящего эксперимента с бутербродом состоит в том, что нас будет интересовать не распределение вероятности (точное или эмпирическое), а зависимость вероятности от параметров задачи.  Мы будем искать ответ на вопрос: при каких обстоятельствах выполняется закон бутерброда? Будем подавать на вход нашей динамической системы различные конкретные параметры, получать конкретные результаты и набирать статистику по падениям маслом вверх и маслом вниз. Я убеждён, что намеренно <a href="https://www.youtube.com/watch?v=eFHXWuKNhms">ронять настоящие бутерброды</a> на пол неправильно, поэтому мы воспользуемся математическим моделированием. Для решения задачи о падении бутерброда я выбрал <a href="http://brm.io/matter-js/">один</a> из доступных симуляторов физического мира, которые используют для создания онлайн игр. Он позволил создать виртуальные стол и пол, а также два бутерброда. Один оказывался на краю стола, а второй -- "выскальзывал из пальцев", то есть, соскальзывал с точечной опоры. В моих силах задавать начальные позицию и угол бутерброда, горизонтальную скорость (случай смахивания бутерброда со стола), коэффициенты трения, размеры бутерброда и высоту падения. Эксперименты выглядят как-то так:

<img src="https://habrastorage.org/webt/u5/g4/dv/u5g4dvsma2opnp2odqe5lvvetr0.gif" width="90%" align="center"/><i>Эксперименты с падением виртуальных бутербродов в симуляторе физического мира.</i>

В момент касания бутербродом пола фиксируется угол бутерброда, вернее, угол вектора, нормального к нему. О том, с какой стороны оказалось масло, нам скажет знак синуса этого угла: положительному значению соответствует удачный случай, а отрицательному -- положение маслом вниз. Результат заносится в таблицу, и новый виртуальный бутерброд готов к падению. Задачу мы поставим такую: оценить вероятность падения бутерброда маслом вниз при его падении с заданной высоты. 

Сначала нужно задать диапазоны и законы распределения для входных параметров. Это важная и интересная часть задачи. 

<img src="https://habrastorage.org/webt/p_/lo/tp/p_lotpbr0hjy_w45975u6m89bcq.png" width="50%" align="right"/>1. Размеры бутерброда. Какими они могут быть? Разумной величины канапе имеет сантиметра $inline$3$inline$ в ширину, а студенческий добрый "лапоть" может быть сантиметров $inline$15$inline$. Чаще всего, бутерброды имеют размеры от $inline$6$inline$ до $inline$10$inline$&nbsp;см. При этом вероятность встретить бутерброд миллиметровой или метровой ширины, в практическом смысле, равна нулю. Больше про бутерброды я ничего сказать не могу и приму размеры бутербродов <i>равномерно распределёнными</i> в указанном диапазоне. Выбор неидеален, всё же нормальные бутерброды мы встречаем чаще крошечных или гигантских. Но позже мы увидим, что это слабое место можно изящно обойти.

2. Начальное положение. Тут мы не мудрствуя зададим равномерное распределение для смещения бутерброда над краем стола, лишь бы он вообще упал.

<img src="https://habrastorage.org/webt/pw/k7/bw/pwk7bwilnucrd1qeum_5tx4xx1g.png" width="50%" align="right"/>3. Коэффициент трения. Это безразмерная величина, зависящая только от материала. Столы и скатерти бывают разные, пальцы сжимают бутерброд с разной силой. Диапазон коэффициента от $inline$0.01$inline$ до $inline$0.5$inline$, при этом крайние значения маловероятны, в среднем можно ожидать что-то около $inline$0.3$inline$. Тут нам поможет любое колоколообразное несимметричное распределение неотрицательной величины, например <i>гамма-распределение</i> или <i>лог-нормальное</i>.

<img src="https://habrastorage.org/webt/gi/zb/l-/gizbl-hctfatourn0xtbvdhv9cy.png" width="50%" align="right"/>4. Начальная скорость. Мы редко запускаем бутерброды с большой скоростью, и чаще всего не кидаем их вовсе, но смахнуть, всё же, случается. Про величину скорости известно лишь, что она положительна и можно предположить, что при смахивании в среднем мы движемся также, как в среднем движутся руки, то есть, со скоростью около $inline$0.5$inline$&nbsp;м/с. Если про величину известно только это, то её разумно описать <i>экспоненциальным распределением</i> (почему, мы поговорим позже, когда узнаем об энтропии распределений). Его мода равна нулю, так что доля бутербродов, упавших без большой начальной скорости будет вполне приличной. В "хвосте" окажутся бутерброды, нечаянно запускаемые в полёт при смахивании крошек со стола.

5. Высоту стола мы будем фиксировать, ронять с неё сотню бутербродов, подсчитывать число упавших маслом вниз и заносить в таблицу, либо отражать на графике вероятности от высоты.

Вот, какие вероятности уронить бутерброд маслом вниз у нас получаются после того, как мы терпеливо сбросили по сотне бутербродов с каждой высоты:

<img src="https://habrastorage.org/webt/7z/nk/29/7znk29cv7cfnnbmeerouledyhma.png" width="85%" align="center"/><i>Вероятность приземления маслом вниз разных бутербродов с разными условиями в зависимости от высоты падения. Для каждой высоты бросалось $inline$100$inline$ бутербродов.</i>

Какая-то тенденция видна, но получился очень большой разброс. При усреднении получается что вероятность от высоты падения почти не зависит едва превышает половину. Можно ли доверять такому эксперименту? Опровергает ли он закон бутерброда? Может быть, мы недостаточно много бросали бутербродов -- вон какие шумные получились данные! Давайте увеличим число бросаний, и посмотрим, что получится:

<img src="https://habrastorage.org/webt/jp/c1/v7/jpc1v71j7vpaqh_ek0tsoeu4kkm.png" width="85%" align="center"/><i>Вероятность приземления маслом вниз разных бутербродов посчитанная для большего числа кидаемых бутербродов (500 штук на каждую высоту).</i>

Выбросов стало меньше, но ещё более отчётливо видно, что закон бутерброда весьма и весьма слаб. Но правильно ли мы выполняли наши эксперименты? Метод Монте Карло выглядит заманчиво простым: знай себе подставляй какие попало данные и смотри, что получается. Математика честная штука: для какой попало вопрос она готова дать какой попало ответ. А вот имеет ли смысл этот ответ, сильно зависит от вопроса.

Перед тем как приступать к экспериментам, не таким игрушечным, как у нас, а настоящим и дорогостоящим, использующим орбитальный спутник, ускоритель элементарных частиц или тысячу настоящих бутербродов с маслом, необходимо проводить подготовительную работу. И одним из мощных и красивых способов, позволяющих понять, как правильно проводить эксперимент, является <i>анализ размерностей</i> задачи. 

Бутерброд мы моделировали обобщёнными координатами, импульсами и силами -- физическими величинами, которые, в свою очередь связаны уравнениями аналитической механики. В физике количественные величины, с которыми мы имеем дело, которые мы измеряем и подставляем в уравнения не "умещаются" в обыкновенные числа -- они имеют дополнительную структуру, которая называется <i>размерностью</i>. Не все корректные математические выражения имеют смысл, если в них участвуют размерные величины. Скажем, нет смысла складывать скорость и массу, невозможно сравнить силу и расстояние. Однако, можно рассмотреть произведение скорости и массы, получив новую размерную величину -- количество движения, или импульс; можно возвести скорость в квадрат и поделить на расстояние, получив таким образом, величину, имеющую размерность ускорения. 

Анализ размерности и теория подобия родились давно, со времён лорда Релея. Они используются в механике, электродинамике, в астрофизике и космологии, позволяя с пугающей изящность подходить к решению сложных задач. Однако исследования в этой области не завершены и строгое определение структуры, образуемой количественными (размерными) величинами было дано лишь в 2016 году испанским математиком Альваро Рапозо. 

Эти ограничения на физические формулы часто воспринимаются учениками и студентами, как лишняя морока, за которой нужно следить. Но с другой стороны, логически согласованные ограничения чрезвычайно полезны! Они отсеивают неверные выражения, они позволяют "предвидеть" структуру решения физической задачи до её детального решения, они являются мощным инструментом при планировании и анализе экспериментальных данных.

Но мы рассчитывали падение бутерброда в программе, используя не размерные, а обыкновенные числа. Как можно "очистить" физические величины от размерности и превратить в вещественные числа? Для этого служат хорошо нам знакомые <i>единицы измерения</i> физических величин: все эти метры, фунты, минуты и ньютоны. Единицы измерения берут на себя размерную часть величины, оставляя нам множитель -- вещественное число, с которым уже может иметь дело вычислительная машина. Например, скорость в выбранном направлении величиной $inline$60$inline$&nbsp;км/ч можно представить числом $inline$60$inline$. Но тут есть тонкость: от выбора единиц измерения зависит числовое представление. При выборе других единиц (скажем, метров и секунд) <i>эта же скорость</i> будет представлена другим числом: $inline$16.7$inline$. Числа разные, но величина одна, и она не зависит от нашего выбора каких-то единиц. 

А существует ли в каком-либо смысле "самая лучшая" система единиц? Оказывается, существует, для этого при решении задачи нужно использовать в качестве единиц измерения размерные величины, входящие в задачу. 

В этой главе у нас всё летает, приведём ещё один летательный пример. Как следует сравнивать лётные качества различных птиц? Понятно, что скорости, которые развивают птицы, различны: у голубя -- $inline$90$inline$&nbsp;км/ч, у стрижа -- $inline$140$inline$&nbsp;км/ч, у журавля, воробья или кряквы -- $inline$50$inline$&nbsp;км/ч, у колибри -- $inline$80$inline$&nbsp;км/ч. Но все эти птицы существенно различаются по размерам и манере полёта. Если длину попугая измерять в попугаях, а время -- в периодах взмаха его крыльев, можно получить некую, как говорят, <i>собственную скорость</i>. Можно разделить скорости, которые могут развивать эти птицы, на собственные значения и получить безразмерную скорость, показывающая на сколько длин корпуса может переместиться птица за один взмах крыльев. Вот что получается при таком сравнении:
<table>
<tr><th>птица</th><th>скорость, км/ч</th><th>длина тела</th><th>частота взмахов, 1/с</th><th>собственная скорость, м/с</th><th>безразмерная скорость</th></tr>
<tr><td>стриж</td><td>140</td><td>18 см</td><td>5</td><td>0,9</td><td>43</td></tr>
<tr><td>почтовый голубь</td><td>90</td><td>30 см</td><td>5</td><td>1,5</td><td>17</td></tr>
<tr><td>колибри</td><td>80</td><td>8 см</td><td>200</td><td>16</td><td>1,4</td></tr>
<tr><td>журавль</td><td>50</td><td>1 м</td><td>2,5</td><td>2,5</td><td>5</td></tr>
<tr><td>кряква</td><td>50</td><td>40 см</td><td>9</td><td>3,6</td><td>3,8</td></tr>
<tr><td>воробей</td><td>46</td><td>12 см</td><td>13</td><td>1,6</td><td>8</t></tr>
</table>
Видно, что стриж по праву считается лучшим летуном, а вот колибри неэффективно расходует энергию, впрочем, у этой птицы нет задачи лететь долго, как у голубя. Одинаковые абсолютные скорости журавля, воробья и утки существенно различаются при переводе в безразмерные величины. Такого рода расчёты используются чтобы моделировать настоящий большой самолёт, испытывая маленькую модель в аэродинамической трубе. Если все безразмерные параметры этих двух систем близки, они могут считаться <i>физически подобными</i> и моделирование имеет смысл. Мы уже пользовались таким подходом, отражая на диаграммах Лоренца относительные единицы вместо абсолютных. Это позволяло нам сравнивать между собой различные явления и распределения. 

Понятно, какой будет самая подходящая система единиц при анализе полёта бутерброда. Конечно же, длину надо измерять в бутербродах. За единицу времени можно взять величину $inline$\sqrt{l/g}$inline$, где $inline$l$inline$ -- длина бутерброда, а $inline$g$inline$ -- ускорение свободного падения. И высоту стола следует измерять не в метрах, а в собственных единицах. Получив таким образом результат, мы сразу можем обобщить его как на случай канапе, так и для солидного "лаптя". Итак, повторим вычисления, но на графике отразим высоту стола в относительных единицах. Если мы всё сделали правильно, то для двух разных по размерам бутербродов мы должны получить очень похожие графики. Давайте проверим это:

<img src="https://habrastorage.org/webt/ju/hq/px/juhqpxbj9kirya6ywhhbtpjmvfc.png" width="85%" align="center"/><i>Вероятность приземления маслом вниз бутерброда некоторой фиксированной величины, при различной высоте падения, вычисленной в относительных единицах. Зелёные точки соответствуют бутерброду размером $inline$5$inline$&nbsp;см, красные -- $inline$10$inline$&nbsp;см.</i>

В первоначальной постановке мы, перебирая различные размеры, получали облако результатов, в котором оказалась скрыта интересующая нас зависимость. При увеличении числа испытаний, мы это облако усреднили и получили неинтересный ответ. Чтобы ярче показать в чём состояла методическая ошибка, представьте, что мы захотим вычислить вероятность падения бутерброда маслом вниз, перебирая случайным образом и начальные условия и размеры бутерброда и высоту. Это равносильно усреднению всех полученных нами результатов. В итоге мы получим уверенную серединку -- вероятность, очень близкую к $inline$1/2$inline$, как при подбрасывании монетки! Это очень логичный и ожидаемый результат, но он совершенно неинтересен. Усредняя множество данных для разных размеров мы уже приблизились к такому результату. Но если цель моделирования состоит в выявлении закономерности, то имеет смысл минимизировать число параметров. 

Очищенные данные теперь чётко говорят в пользу закона подлости, ограничивая его, однако, определённым диапазоном высот: от $inline$2$inline$ до $inline$6$inline$ размеров бутерброда (от высоты локтя над столом до высоты руки стоящего человека). За пределами этого диапазона у бутерброда повышается шанс повернуться нужной стороной перед падением. 

А что если заглянуть дальше, и кидать бутерброды из окна? Понятно, что при падении с большой высоты уже становится неважно какой стороной упало то, во что превратится бутерброд, и сопротивление воздуха стабилизирует падение, но чисто теоретически, что мы ожидаем увидеть? Наверное, должны наблюдаться некие колебания вероятности по мере увеличения времени полёта. Давайте посмотрим:
<img src="https://habrastorage.org/webt/qa/cb/gv/qacbgv4bnasbqzbuh1mcxr5zdp4.png
" width="85%" align="center"/><i>Вероятность приземления маслом вниз бутерброда при падении с большой высоты.</i>

С частотой мы угадали, но любопытно, что амплитуда уменьшается, и колебания вероятности сходятся к $inline$0.5$inline$. О чём это может говорить? Тот же ли это эффект, что и в случае с монеткой, когда при увеличении длительности полёта становятся более существенными последствия отклонений начальных условий? Оказывается, в данном случае природа выравнивания вероятностей иная. 

<h3>Ещё немного анализа размерностей</h3>

Какой бы несерьёзной ни была тема нашей книжки, мы говорим на языке математики, а он стремится к точным решениям. Метод Монте-Карло позволил нам получить представление о решении, но это было то, что называется грубой силой. Это не так интересно, как хоть какое-то, но аналитическое решение. Анализ размерностей позволит нам получить теоретический вид зависимости, полученной методом Монте-Карло. Для этого нам не понадобится решать дифференциальные уравнения, более того, все наши рассуждения не выйдут за пределы вполне примитивных и очевидных соотношений. В этом и состоит очарование анализа размерностей. Итак приступим, ограничиваясь для простоты лишь соскальзыванием бутерброда длины $inline$l$inline$ со стола высоты $inline$H$inline$ с нулевой горизонтальной скоростью.

1. Как мы уже замечали, угол поворота падающего бутерброда зависит от времени и угловой скорости: $$display$$\varphi=t\omega.$$display$$
2. Угловая скорость, равна произведению времени соскальзывания и углового ускорения:  $$display$$\omega = t_0\varepsilon.$$display$$ 
3. Время соскальзывания можно выразить через ускорение свободного падения и часть длины бутерброда, которая соприкасалась со столом следующей пропорцией: $$display$$t_0 \propto \sqrt{\frac{l_0}{g}}.$$display$$ Здесь $inline$l_0$inline$ -- длина бутерброда, лежавшая на столе. Здесь мы используем отношение пропорциональности, обозначенное знаком $inline$\propto$inline$. Выражение $inline$y \propto x$inline$ можно заменить на $inline$y = C x$inline$, где $inline$C$inline$ -- какая-то неизвестная константа. Я очень люблю это отношение. Пропорциональность "вбирает в себя" всё сложное, что превращается в константу: и то, что при повороте меняется момент силы тяжести, и то что при соскальзывании изменяется центр вращения. Всё это, конечно, нужно знать для точного расчёта, но в результате получится всего лишь безразмерный коэффициент, а в нашем анализе он не играет роли. Одним значком мы избавили себя от утомительного интегрирования.

4. Угловое ускорение происходит от ускорения силы тяжести и зависит от плеча, к которому сила тяжести прилагается: $$display$$\varepsilon \propto \frac{g}{l-l_0}.$$display$$ И опять знак $inline$\propto$inline$ позволил нам не вычислять момента инерции пластины для оси, лежащей в её плоскости, а так же  изменяющейся проекции силы тяжести (это ещё два интеграла).

5. Наконец, время падения зависит от высоты стола и ускорения свободного падения: $$display$$t \propto \sqrt{\frac{H}{g}}.$$display$$
6. Подставляя все эти выражения в первую формулу, получаем простой результат:
$$display$$\varphi\propto\sqrt{\frac{l_0 H}{l(l-l_0)}},$$display$$ который, если измерять все длины в бутербродах, превращается в  $$display$$\varphi\propto\sqrt{\frac{x h}{1-x}}.$$display$$ Здесь $inline$l_0 = x l$inline$ и $inline$H = h l$inline$. Что же, всё сходится -- угол величина безразмерная и зависит она от безразмерных коэффициентов. От масштаба времени этот угол не зависит, остаётся чистая геометрия.

То, какой стороной упадет бутерброд определяется знаком синуса угла $inline$\varphi$inline$, то есть функцией $inline$\mathrm{sign}(\sin\varphi)$inline$. Эта функция возвращает $inline$-1$inline$ для случая "маслом вверх" и $inline$1$inline$ для "масло вниз". Мы можем использовать эту функцию для выражения вероятности падения детерминистического бутерброда, если приведём её к диапазону от $inline$0$inline$ до $inline$1$inline$:  $$display$$P_{\downarrow}(x,h) = \frac12\left\{1+\mathrm{sign}\left[\sin\left(C \sqrt{\frac{x h}{1-x}}\right)\right]\right\},$$display$$ где стрелочка символически означает положение масла.  Коэффициент $inline$C$inline$, появившийся в формуле вероятности выражает всё то, что осталось спрятанным с помощью знака пропорциональности. Это был очень хитрый ход, он избавил нас от утомительного интегрирования, (и даже трёх), но как же нам теперь узнать чему равен этот коэффициент? Из эксперимента, причём достаточно одного единственного эксперимента с измерением угла в момент падения, чтобы получить оценку этого значения! С помощью симулятора я легко выяснил, что $inline$C = 2.3$inline$. 

Следующая задача -- математически выразить то, что начальные положения $inline$x$inline$ могут быть разными. И тут нам опять пригодятся результаты теории мер. Нас интересует вероятность того, что бутерброд упадёт маслом вниз, если $inline$x$inline$ будет равно $inline$0.2$inline$ или $inline$0.4$inline$ или любому числу от $inline$0$inline$ до $inline$0.5$inline$. Мы использовали союз "или", при этом каждый из этих случаев рассматривается нами, как независимый и исключающий все прочие при проведении конкретного эксперимента. Мы говорили, что вероятность -- это мера на множестве событий. Раз так, то вероятность аддитивна. Это позволяет нам попросту сложить вероятности $inline$P_{\downarrow}(x,h)$inline$, для всех значений $inline$x$inline$, умножив из предварительно на вероятность попадания в конкретный диапазон значений. Разобъём торезок от $inline$0$inline$ до $inline$0.5$inline$ на $inline$n$inline$ частей, и вычислим оценку вероятности в виде суммы:$$display$$P_{\downarrow}(h) \sim \frac{2}{n}\sum\limits_{i = 0}^n P_{\downarrow}\left(\frac{i}{2n},h\right),$$display$$ здесь множитель $inline$2/n$inline$ выражает вероятность для случайной величины $inline$x$inline$ попасть в отрезок ширины $inline$1/n$inline$. Вот как выглядят результат для значительного числа разбиений ($inline$n=100$inline$) и серия численных экспериментов с нулевой горизонтальной скоростью:

<img src="https://habrastorage.org/webt/05/ia/t4/05iat4kpusfsobkeedzifmpn2m0.png" width="85%" align="center"/><i>Теоретическая и экспериментальная оценка вероятности приземления маслом вниз бутерброда при падении с большой высоты. Начальная горизонтальная скоростьв экспериментах равна нулю.</i> 

Решение, которое мы приводили до этого, содержит больше случайных параметров, поэтому оно оказалось в большей степени сглаженным и приближенным к $inline$0.5$inline$. Но, в принципе, анализ размерности можно провести и для более общего случая. 

Обратите внимание на то, что вероятность $inline$P_{\downarrow}$inline$ приближается, при увеличении $inline$h$inline$, к значениям, близким к $inline$0.5$inline$. И это происходит вовсе не из-за неопределённости и влияния начальных ошибок. Вычисления показали, что это результат сложения множества гармоник, образуемых значениями $inline$x$inline$, при суммировании $inline$P_{\downarrow}(x,h)$inline$. Если мы забудем про несчастный бутерброд и продолжим график $inline$P_{\downarrow}$inline$, то увидим, что оценка вероятности так продолжит колебаться вблизи $inline$0.5$inline$, постепенно стремясь к этому значению.

А можно ли выяснить без прямых вычислений, будет ли вероятность продолжать сходится к $inline$0.5$inline$ или когда-нибудь снова станет расти? И в этом явлении тоже есть место нетривиальной и глубокой математике. Дело в том, что каждому значению $inline$x$inline$ соответствует определённая частота колебаний, а весь набор формирует так называемый <i>спектр</i> суммарной функции. Если спектр дискретный, то есть состоит из отдельных частот, то суммарная функция будет периодичной. Непрерывному спектру в виде константы на отрезке от $inline$0$inline$ до $inline$0.5$inline$ будет соответствовать апериодичная функция, похожая на убывающие  колебания. Но это мы заглянули в новый раздел математики -- в <i>функциональный анализ</i>.

Великий Энрико Ферми, дедушка метода Монте Карло (отцом считается математик Станислав Улам), приучал своих учеников делать простые оценочные вычисления, прикинуть на клочке бумаги или на пальцах, что мы ожидаем получить прежде чем приступать к точному решению задачи. Замечательно, что если оценка окажется верной, станет понятно, что суть проблемы ухвачена, если же нет, то это тем более полезный результат -- значит, задача оказалась интереснее, чем кажется! 
  
В нашем случае простой оценки вполне достаточно, задача о бутерброде не стоит более тщательного решения. Метод Монте-Карло показал нам только намётки решения, и анализ размерности показал лишь некоторую его общую структуру, но вместе они смогли нам показать как устроена искомая вероятность. Эрудиция позволяет математику видеть в намётках решения готовые структуры и делать далеко идущие предположения и выводы.   

$$display$$* * *$$display$$

В завершении разговора о монетках и бутербродах осталось добавить, что масло, смещая центр масс бутерброда, никак не влияет на полученный нами результат, ведь вращение и падение останутся такими же. Вообще, слегка нечестную монетку сделать непросто: ни изгибание, ни подтачивание не повлияет на её полёт. Однако, если мы не ловим монетку в полёте, а роняем её на пол или на стол, то при падении наличие дефектов становится существенным. И, конечно же, воздух будет оказывать существенное влияние при падении с большой высоты. Вихрь, рождающийся за падающей пластинкой, стабилизирует её поперечное положение и прекратит вращение.

<h3>От бутербродов к бабочкам и судьбе</h3>

Наблюдения за тем, как малые отклонения вырастают в глобальные изменения системы, приводят к мысли об "эффекте бабочки". Напомню, что под этим эффектом подразумевается цепочка далеко идущих драматичных последствий от некоторого незначительного, на первый взгляд, события. Раздавленная исследователями прошлого бабочка в рассказе Рея Бредбери "И грянул гром" привела к кардинальной перестройке будущего. А одну из своих лекций Эдвард Лоренц, создатель теории динамического хаоса, озаглавил так: "Может взмах крыла бабочки в Бразилии вызвать торнадо в Техасе?"

На этот эффект мы неявно ссылаемся, сетуя: "Не поверни я за угол, всё было бы по-другому!", "Не сел бы он в этот поезд, с ним не случилось бы катастрофы!" или "Из-за такой мелочи разругались и разошлись!!" Но мы видим, что в мире сосуществуют истинно стохастический квантовый мир и сверхточные атомные часы, устойчивые гамильтоновы системы в мире звёзд и галактик и хаос колец Сатурна и пояса Койпера, тепловое движения молекул и удивительная точность работы биологических систем или механизмов автомобиля. Нет, взмах крыла бабочки не порождает ураганов, а бесследно исчезает, порождая цепочку вихрей, передающих энергию и информацию всё более и более мелким вихрям, покуда и та и другая не исчезнут в хаосе флуктуаций.  Надо чётко понимать, что малые отклонения приводят к кардинальной перестройке системы лишь, если она неустойчива или если система находится на пороге <i>бифуркации</i> или <i>катастрофы</i> -- так на языке математики называются глобальные перестройки в поведении системы при малых изменениях параметров. А бифуркации всегда образуют множества нулевой меры в пространстве параметров -- это точки или границы. Малые возмущения не приводят к катастрофам <i>почти всюду</i>, (это точный термин означающий "везде, кроме множества нулевой меры"), а неустойчивые состояния в природе наблюдаются редко, не проходя "проверку временем".  

Если пара распалась "из-за ерунды", ей суждено было распасться в любом случае, она была неустойчивой. Устойчивые пары проходят сквозь войны и голод, а потом, бывает и, распадаются, но не из-за мелочей, а в результате глубоких перемен, могущих произойти с личностью в течение жизни. В цепочке событий, приведших к катастрофе поезда нелегко однозначно выделить ключевое событие (конкретную ошибку или роковую случайность) и, скорее всего, ключевым будет не событие, а систематическое нарушение правил, приводящее систему к неустойчивому состоянию.  Если в системе множество параметров, и ряд из них случаен, а наша жизнь устроенна именно так, то информация в такой системе имеет свойство теряться и уже никак не удастся восстановить в какой именно момент в нашей жизни "всё пошло не так". Не терзайте себя сожалениями о случившемся, а присмотритесь к настоящему, чтобы не пропустить настоящей точки бифуркации.

Не так была важна была цель нашего пути: объяснение случайности выпадения орла или решки, либо оправдание закона бутерброда, как сам путь. Он показал как совмещение разных математических методов позволяет взглянуть на задачу с разных сторон и дарит достаточно точное знание, даже без детального решения задачи. В согласованности различных математических дисциплин, подходов и точек зрения состоит сила и красота математики. Тут уместно вспомнить чудесные слова Марины Цветаевой: <i>"Я не хочу иметь точку зрения, я хочу иметь зрение"</i>. Изучение различных областей математики способно дать исследователю настоящее "объёмное" многомерное зрение, позволяющее заглянуть в кажущееся закрытым и скрытым пространство знаний.
